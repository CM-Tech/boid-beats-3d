import{S as e,C as t,M as n,P as a,a as r,W as i,R as o,D as s,F as u,N as l,b as d,G as c,c as h,d as m,e as v,f as p,s as f,H as g,V as w,g as x,h as T,B as y,i as b}from"./vendor.42a720c4.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const a=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,i)=>{const o=new URL(e,a);if(self[t].moduleMap[o])return n(self[t].moduleMap[o]);const s=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),u=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){i(new Error(`Failed to import: ${e}`)),r(u)},onload(){n(self[t].moduleMap[o]),r(u)}});document.head.appendChild(u)})),self[t].moduleMap={}}}("assets/");var M,S,F,R,C,D=function(c,h,m){this.variables=[],this.currentTextureIndex=0;var v=u,p=new e,f=new t;f.position.z=1;var g={passThruTexture:{value:null}},w=y("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",g),x=new n(new a(2,2),w);function T(e){e.defines.resolution="vec2( "+c.toFixed(1)+", "+h.toFixed(1)+" )"}function y(e,t){var n=new r({uniforms:t=t||{},vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return T(n),n}p.add(x),this.setDataType=function(e){return v=e,this},this.addVariable=function(e,t,n){var a={name:e,initialValueTexture:n,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:l,magFilter:l};return this.variables.push(a),a},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!m.capabilities.isWebGL2&&!m.extensions.get("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===m.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(var e=0;e<this.variables.length;e++){var t=this.variables[e];t.renderTargets[0]=this.createRenderTarget(c,h,t.wrapS,t.wrapT,t.minFilter,t.magFilter),t.renderTargets[1]=this.createRenderTarget(c,h,t.wrapS,t.wrapT,t.minFilter,t.magFilter),this.renderTexture(t.initialValueTexture,t.renderTargets[0]),this.renderTexture(t.initialValueTexture,t.renderTargets[1]);var n=t.material,a=n.uniforms;if(null!==t.dependencies)for(var r=0;r<t.dependencies.length;r++){var i=t.dependencies[r];if(i.name!==t.name){for(var o=!1,s=0;s<this.variables.length;s++)if(i.name===this.variables[s].name){o=!0;break}if(!o)return"Variable dependency not found. Variable="+t.name+", dependency="+i.name}a[i.name]={value:null},n.fragmentShader="\nuniform sampler2D "+i.name+";\n"+n.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){for(var e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0,n=0,a=this.variables.length;n<a;n++){var r=this.variables[n];if(null!==r.dependencies)for(var i=r.material.uniforms,o=0,s=r.dependencies.length;o<s;o++){var u=r.dependencies[o];i[u.name].value=u.renderTargets[e].texture}this.doRenderTarget(r.material,r.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=T,this.createShaderMaterial=y,this.createRenderTarget=function(e,t,n,a,r,s){return new i(e=e||c,t=t||h,{wrapS:n=n||d,wrapT:a=a||d,minFilter:r=r||l,magFilter:s=s||l,format:o,type:v,depthBuffer:!1})},this.createTexture=function(){var e=new Float32Array(c*h*4);return new s(e,c,h,o,u)},this.renderTexture=function(e,t){g.passThruTexture.value=e,this.doRenderTarget(w,t),g.passThruTexture.value=null},this.doRenderTarget=function(e,t){var n=m.getRenderTarget();x.material=e,m.setRenderTarget(t),m.render(p,f),x.material=w,m.setRenderTarget(n)}},V=function(){var e=9216;y.call(this);var t=new b(new Float32Array(27648),3),n=new b(new Float32Array(27648),3),a=new b(new Float32Array(18432),2),r=new b(new Float32Array(e),1);this.setAttribute("position",t),this.setAttribute("birdColor",n),this.setAttribute("reference",a),this.setAttribute("birdVertex",r);var i=0;function o(){for(var e=0;e<arguments.length;e++)t.array[i++]=arguments[e]}for(var s=0;s<1024;s++)o(0,-0,-20,0,4,-20,0,0,30),o(0,0,-15,-20,0,0,0,0,15),o(0,0,15,20,0,0,0,0,-15);for(i=0;i<9216;i++){var u=~~(i/3),l=u%32/32,d=~~(u/32)/32,c=new m(4473924+~~(i/9)/1024*6710886);n.array[3*i+0]=c.r,n.array[3*i+1]=c.g,n.array[3*i+2]=c.b,a.array[2*i]=l,a.array[2*i+1]=d,r.array[i]=i%9}this.scale(.2,.2,.2)};V.prototype=Object.create(y.prototype);var A,E,I,L,U,_,P,W,B=0,O=0,k=window.innerWidth/2,H=window.innerHeight/2,j=performance.now(),z=!1;function q(e){var t=e||1024;this.spectrum=[],this.volume=this.vol=0,this.peak_volume=0;var n=this;this.getRMS=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n]*e[n];return t/=e.length,t=Math.sqrt(t)},new AudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,this.init=function(){try{!function(e){function a(a){var r=e.createAnalyser();r.smoothingTimeConstant=.2,r.fftSize=t;var i=e.createScriptProcessor(2*t,1,1);i.onaudioprocess=function(){n.spectrum=new Uint8Array(r.frequencyBinCount),r.getByteFrequencyData(n.spectrum),n.vol=n.getRMS(n.spectrum),n.vol>n.peak_volume&&(n.peak_volume=n.vol),n.volume=n.vol},e.createMediaStreamSource(a).connect(r),r.connect(i),i.connect(e.destination)}function r(){console.log(arguments)}navigator.getUserMedia({audio:!0},a,r)}(new AudioContext)}catch(e){console.error(e),alert("Web Audio API could not be called, check that the url starts with https:// and not http://")}}}window.Microphone=q;var G=document.querySelector("audio");function N(e){window.location.hash=e.split("#").pop()}function X(){G.src="https://cdn.glitch.com/7c659aa6-fe5f-4610-bdf3-3fd76117d9a5%2F"+window.location.hash.slice(1)+".mp3",G.classList.add("paused")}var $,Y=new function(){this.speed=1,this.directions=6,this.turning=!0,this.lineWidth=1,this.song=window.location.hash.slice(1)?"/#"+window.location.hash.slice(1):"/#300%20Violin%20Orchestra",this.activateMic=oe,this.tThreshold=.3,this.calibrate=()=>1e3};window.onload=function(){var e=new c;e.add(Y,"song",{"Glorious Morning":"/#Glorious_morning",Jumper:"/#Jumper",Stride:"/#Stride-","300 Violin Orchestra":"/#300%20Violin%20Orchestra","ThunderZone v2":"/#638150_-ThunderZone-v2-","Portugal The Man - Feel it Still":"/#Portugal.%20The%20Man%20-%20Feel%20It%20Still","The XX - Intro":"/#00%20Intro","Hall of the Mountain King":"/#Hall%20of%20the%20Mountain%20King",'Everybody Wants To Rule The World (7" Version)':"/#Everybody%20Wants%20To%20Rule%20The%20World%20(7%20Version)",Flight:"/#Flight","Electroman Adventures V2":"/#Waterflame%20-%20Electroman%20Adventures%20V2",Rasputin:"/#Rasputin"}).onChange(N),e.add(Y,"activateMic").name("useMicrophone")},window.location.hash&&X(),window.addEventListener("hashchange",X);var J=new(window.AudioContext||window.webkitAudioContext),K=J.createAnalyser();K.connect(J.destination),K.fftSize=512,K.smoothingTimeConstant=.2;J.createMediaElementSource(G).connect(K);var Z=100*Math.floor(250/(1e3/60));let Q=[],ee=[];for(var te=0;te<256;te++)Q.push(0),ee.push(0);let ne=Q.slice();var ae=[];for(te=0;te<Z;te++){var re=new Uint8Array(256);ae.push(re)}let ie=new Uint8Array(256).fill(0);function oe(){z=!0,$||($=new q(512)).init()}function se(){k=window.innerWidth/2,H=window.innerHeight/2,F.aspect=window.innerWidth/window.innerHeight,F.updateProjectionMatrix(),C.setSize(window.innerWidth,window.innerHeight)}function ue(e){B=e.clientX-k,O=e.clientY-H}function le(e){1===e.touches.length&&(e.preventDefault(),B=e.touches[0].pageX-k,O=e.touches[0].pageY-H)}function de(e){1===e.touches.length&&(e.preventDefault(),B=e.touches[0].pageX-k,O=e.touches[0].pageY-H)}G.addEventListener("pause",(()=>{G.classList.add("paused")})),G.addEventListener("play",(()=>{J.resume(),G.classList.remove("paused")})),function(){M=document.createElement("div"),document.body.appendChild(M),(F=new h(75,window.innerWidth/window.innerHeight,1,3e3)).position.z=500,(R=new e).background=new m(0),R.fog=new v(0,100,1e3),(C=new p).setPixelRatio(window.devicePixelRatio),C.setSize(window.innerWidth,window.innerHeight),M.appendChild(C.domElement),function(){A=new D(32,32,C),function(){return!!navigator.userAgent.match(/Safari/i)&&!navigator.userAgent.match(/Chrome/i)}()&&A.setDataType(g);var e=A.createTexture(),t=A.createTexture(),n=A.createTexture();(function(e){for(var t=e.image.data,n=0,a=t.length;n<a;n+=4){var r=800*Math.random()-400,i=800*Math.random()-400,o=800*Math.random()-400;t[n+0]=r,t[n+1]=i,t[n+2]=o,t[n+3]=1}})(e),function(e){for(var t=e.image.data,n=0,a=t.length;n<a;n+=4){var r=Math.random()-.5,i=Math.random()-.5,o=Math.random()-.5;t[n+0]=1*r,t[n+1]=1*i,t[n+2]=1*o,t[n+3]=1}}(t),function(e){for(var t=e.image.data,n=0,a=t.length;n<a;n+=4){var r=Math.random(),i=Math.random(),o=Math.random();t[n+0]=r,t[n+1]=i,t[n+2]=o,t[n+3]=1}}(n),E=A.addVariable("textureVelocity",document.getElementById("fragmentShaderVelocity").textContent,t),I=A.addVariable("texturePosition",document.getElementById("fragmentShaderPosition").textContent,e),L=A.addVariable("textureColor",document.getElementById("fragmentShaderColor").textContent,n),A.setVariableDependencies(E,[I,E,L]),A.setVariableDependencies(I,[I,E]),A.setVariableDependencies(L,[I,E,L]),U=I.material.uniforms,_=E.material.uniforms,P=L.material.uniforms,U.time={value:0},U.delta={value:0},_.time={value:1},_.delta={value:0},_.testing={value:1},_.separationDistance={value:1},_.alignmentDistance={value:1},_.cohesionDistance={value:1},_.freedomFactor={value:1},_.predator={value:new w},_.music={value:ie},_.lmusic={value:ie},E.material.defines.BOUNDS=800..toFixed(2),P.time={value:1},P.delta={value:0},P.testing={value:1},P.separationDistance={value:1},P.alignmentDistance={value:1},P.cohesionDistance={value:1},P.freedomFactor={value:1},P.music={value:ie},P.lmusic={value:ie},P.predator={value:new w},L.material.defines.BOUNDS=800..toFixed(2),E.wrapS=x,E.wrapT=x,I.wrapS=x,I.wrapT=x,L.wrapS=x,L.wrapT=x;var a=A.init();null!==a&&console.error(a)}(),S=new f,document.addEventListener("mousemove",ue,!1),document.addEventListener("touchstart",le,!1),document.addEventListener("touchmove",de,!1),window.addEventListener("resize",se,!1);var t={separation:20,alignment:20,cohesion:20,freedom:.75};_.separationDistance.value=t.separation,_.alignmentDistance.value=t.alignment,_.cohesionDistance.value=t.cohesion,_.freedomFactor.value=t.freedom,P.separationDistance.value=t.separation,P.alignmentDistance.value=t.alignment,P.cohesionDistance.value=t.cohesion,P.freedomFactor.value=t.freedom,function(){var e=new V;W={color:{value:new m(16720384)},texturePosition:{value:null},textureVelocity:{value:null},textureColor:{value:null},time:{value:1},delta:{value:0},music:{value:ie},lmusic:{value:ie}};var t=new r({uniforms:W,vertexShader:document.getElementById("birdVS").textContent,fragmentShader:document.getElementById("birdFS").textContent,side:T}),a=new n(e,t);a.rotation.y=Math.PI/2,a.matrixAutoUpdate=!1,a.updateMatrix(),R.add(a)}()}(),function e(){requestAnimationFrame(e),function(){z?256===$.spectrum.length&&(ie=$.spectrum.slice()):K.getByteFrequencyData(ie);for(var e=0;e<0;e++)ie=ie.map(((e,t)=>{var n=[e];return t<255&&n.push(ie[t+1]),t>0&&n.push(ie[t-1]),Math.max(...n)}));for(ae.unshift(ie.slice()),ae.pop(),ne=[],e=0;e<256;e++){Q[e]=0,ee[e]=0,ne[e]=0;for(var t=0;t<Z;t++)ee[e]=Math.max(ae[t][e],ee[e]);for(Q[e]=ae[0][e]/ee[e]*256,t=0;t<Z/100;t++)ne[e]+=ae[t][e]/Z*100/ee[e]*256}}(),function(){var e=performance.now(),t=(e-j)/1e3;t>1&&(t=1);j=e;let n=[...ie].map(((e,t)=>[ne[t]+ie[t],t]));n.sort(((e,t)=>t[0]-e[0])),n=n.map((e=>{let t=ie[e[1]],n=ne[e[1]];return[256*Math.max(0,(t-n+1e-4)/(t/2+n/2+1e-4))*2,e[1]]}));const a=n.slice(0,32).sort(((e,t)=>e[1]-t[1])).map((e=>e[0])).concat(n.slice(32).map((e=>e[0])));U.time.value=e,U.delta.value=t,_.time.value=e,_.delta.value=t,P.time.value=e,P.delta.value=t,P.music.value=Q,_.music.value=Q,_.lmusic.value=a,P.lmusic.value=a,W.time.value=e,W.delta.value=t,W.music.value=Q,W.lmusic.value=a,_.predator.value.set(.5*B/k,-.5*O/H,0),B=1e4,O=1e4,A.compute(),W.texturePosition.value=A.getCurrentRenderTarget(I).texture,W.textureVelocity.value=A.getCurrentRenderTarget(E).texture,W.textureColor.value=A.getCurrentRenderTarget(L).texture,C.render(R,F)}(),S.update()}();
